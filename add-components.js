const fs = require('fs');
const path = require('path');

const spellsPath = path.join(__dirname, 'src/renderer/public/data/5e/spells.json');
const spells = JSON.parse(fs.readFileSync(spellsPath, 'utf8'));

// Complete components mapping from user-provided 2024 PHB SRD data
const componentsMap = {
  // Cantrips (Level 0)
  "Acid Splash": "V, S",
  "Blade Ward": "V, S",
  "Chill Touch": "V, S",
  "Dancing Lights": "V, S, M (a bit of phosphorus)",
  "Druidcraft": "V, S",
  "Eldritch Blast": "V, S",
  "Fire Bolt": "V, S",
  "Friends": "S, M (some makeup)",
  "Guidance": "V, S",
  "Light": "V, M (a firefly or phosphorescent moss)",
  "Mage Hand": "V, S",
  "Mending": "V, S, M (two lodestones)",
  "Message": "V, S, M (a short piece of copper wire)",
  "Minor Illusion": "S, M (a bit of fleece)",
  "Poison Spray": "V, S",
  "Prestidigitation": "V, S",
  "Produce Flame": "V, S",
  "Ray of Frost": "V, S",
  "Resistance": "V, S",
  "Sacred Flame": "V, S",
  "Shillelagh": "V, S, M (mistletoe)",
  "Shocking Grasp": "V, S",
  "Spare the Dying": "V, S",
  "Starry Wisp": "V, S",
  "Thaumaturgy": "V",
  "Thorn Whip": "V, S, M (the stem of a thorny plant)",
  "Thunderclap": "S",
  "Toll the Dead": "V, S",
  "True Strike": "S, M (a weapon with which you have proficiency and that is worth 1+ CP)",
  "Vicious Mockery": "V",
  "Word of Radiance": "V, S",

  // Level 1
  "Alarm": "V, S, M (a tiny bell and a piece of fine silver wire)",
  "Animal Friendship": "V, S, M (a morsel of food)",
  "Bane": "V, S, M (a drop of blood)",
  "Bless": "V, S, M (a sprinkling of holy water)",
  "Burning Hands": "V, S",
  "Charm Person": "V, S",
  "Color Spray": "V, S, M (a pinch of sand or powder colored red, yellow, and blue)",
  "Command": "V",
  "Compelled Duel": "V",
  "Comprehend Languages": "V, S, M (a pinch of soot and salt)",
  "Cure Wounds": "V, S",
  "Detect Evil and Good": "V, S",
  "Detect Magic": "V, S",
  "Detect Poison and Disease": "V, S, M (a yew leaf)",
  "Disguise Self": "V, S",
  "Divine Favor": "V, S",
  "Ensnaring Strike": "V",
  "Entangle": "V, S",
  "Expeditious Retreat": "V, S",
  "Faerie Fire": "V",
  "Feather Fall": "V, M (a small feather or piece of down)",
  "Find Familiar": "V, S, M (burning incense worth 10+ GP)",
  "Fog Cloud": "V, S",
  "Goodberry": "V, S, M (a sprig of mistletoe)",
  "Grease": "V, S, M (a bit of pork rind or butter)",
  "Guiding Bolt": "V, S",
  "Hail of Thorns": "V",
  "Healing Word": "V",
  "Hellish Rebuke": "V, S",
  "Heroism": "V, S",
  "Hunter's Mark": "V",
  "Ice Knife": "S, M (a drop of water or a piece of ice)",
  "Identify": "V, S, M (a pearl worth 100+ GP)",
  "Inflict Wounds": "V, S",
  "Jump": "V, S, M (a grasshopper's hind leg)",
  "Longstrider": "V, S, M (a pinch of dirt)",
  "Mage Armor": "V, S, M (a piece of cured leather)",
  "Magic Missile": "V, S",
  "Protection from Evil and Good": "V, S, M (holy water or powdered silver and iron)",
  "Purify Food and Drink": "V, S",
  "Ray of Sickness": "V, S",
  "Sanctuary": "V, S, M (a small silver mirror)",
  "Searing Smite": "V",
  "Shield": "V, S",
  "Shield of Faith": "V, S, M (a small parchment with a bit of holy text written on it)",
  "Sleep": "V, S, M (a pinch of fine sand, rose petals, or a cricket)",
  "Speak with Animals": "V, S",
  "Tasha's Hideous Laughter": "V, S, M (tiny tarts and a feather)",
  "Thunderous Smite": "V",
  "Thunderwave": "V, S",
  "Witch Bolt": "V, S, M (a twig struck by lightning)",
  "Wrathful Smite": "V",

  // Level 2
  "Aid": "V, S, M (a strip of white cloth)",
  "Arcane Lock": "V, S, M (gold dust worth 25+ GP, which the spell consumes)",
  "Augury": "V, S, M (specially marked sticks, bones, cards, or other tokens worth 25+ GP)",
  "Barkskin": "V, S, M (a handful of oak bark)",
  "Blindness/Deafness": "V",
  "Blur": "V",
  "Calm Emotions": "V, S",
  "Cloud of Daggers": "V, S, M (a sliver of glass)",
  "Continual Flame": "V, S, M (ruby dust worth 50+ GP, which the spell consumes)",
  "Crown of Madness": "V, S",
  "Darkness": "V, M (bat fur and a piece of coal)",
  "Darkvision": "V, S, M (a dried carrot)",
  "Detect Thoughts": "V, S, M (a copper piece)",
  "Dragon's Breath": "V, S, M (a hot pepper)",
  "Enhance Ability": "V, S, M (fur or a feather)",
  "Enlarge/Reduce": "V, S, M (a pinch of powdered iron)",
  "Flame Blade": "V, S, M (a leaf of sumac)",
  "Flaming Sphere": "V, S, M (a ball of wax)",
  "Gust of Wind": "V, S, M (a legume seed)",
  "Heat Metal": "V, S, M (a piece of iron and a flame)",
  "Hold Person": "V, S, M (a straight piece of iron)",
  "Invisibility": "V, S, M (an eyelash in gum arabic)",
  "Knock": "V",
  "Lesser Restoration": "V, S",
  "Levitate": "V, S, M (a leather loop)",
  "Locate Animals or Plants": "V, S, M (a bit of fur from a bloodhound)",
  "Locate Object": "V, S, M (a forked twig)",
  "Magic Mouth": "V, S, M (jade dust worth 10+ GP, which the spell consumes)",
  "Magic Weapon": "V, S",
  "Misty Step": "V",
  "Moonbeam": "V, S, M (a moonseed leaf)",
  "Pass without Trace": "V, S, M (ashes from burned mistletoe)",
  "Prayer of Healing": "V",
  "Protection from Poison": "V, S",
  "Ray of Enfeeblement": "V, S",
  "Scorching Ray": "V, S",
  "See Invisibility": "V, S, M (a pinch of talc)",
  "Shatter": "V, S, M (a chip of mica)",
  "Silence": "V, S",
  "Spider Climb": "V, S, M (a drop of bitumen and a spider)",
  "Spike Growth": "V, S, M (seven sharp thorns)",
  "Spiritual Weapon": "V, S",
  "Suggestion": "V, M (a snake's tongue)",
  "Warding Bond": "V, S, M (a pair of platinum rings worth 50+ GP each, which the spell consumes)",
  "Web": "V, S, M (a bit of spiderweb)",
  "Zone of Truth": "V, S",

  // Level 3
  "Aura of Vitality": "V",
  "Beacon of Hope": "V, S",
  "Bestow Curse": "V, S",
  "Call Lightning": "V, S",
  "Clairvoyance": "V, S, M (a focus worth 100+ GP, either a jeweled horn for hearing or a glass eye for seeing)",
  "Conjure Animals": "V, S",
  "Counterspell": "S",
  "Create Food and Water": "V, S",
  "Crusader's Mantle": "V",
  "Daylight": "V, S",
  "Dispel Magic": "V, S",
  "Elemental Weapon": "V, S",
  "Fear": "V, S, M (a white feather)",
  "Feign Death": "V, S, M (a pinch of graveyard dirt)",
  "Fireball": "V, S, M (a ball of bat guano and sulfur)",
  "Fly": "V, S, M (a wing feather)",
  "Haste": "V, S, M (a shaving of licorice root)",
  "Hunger of Hadar": "V, S, M (a pickled tentacle)",
  "Hypnotic Pattern": "S, M (a pinch of confetti)",
  "Leomund's Tiny Hut": "V, S, M (a crystal bead)",
  "Lightning Bolt": "V, S, M (a bit of fur and an amber, crystal, or glass rod)",
  "Magic Circle": "V, S, M (salt and powdered silver worth 100+ GP, which the spell consumes)",
  "Mass Healing Word": "V",
  "Meld into Stone": "V, S",
  "Plant Growth": "V, S",
  "Protection from Energy": "V, S",
  "Remove Curse": "V, S",
  "Revivify": "V, S, M (a diamond worth 300+ GP, which the spell consumes)",
  "Sending": "V, S, M (a short piece of fine copper wire)",
  "Sleet Storm": "V, S, M (a pinch of dust and a few drops of water)",
  "Slow": "V, S, M (a drop of molasses)",
  "Speak with Dead": "V, S, M (burning incense)",
  "Spirit Guardians": "V, S, M (a prayer scroll)",
  "Stinking Cloud": "V, S, M (a rotten egg)",
  "Tongues": "V, M (a miniature ziggurat)",
  "Vampiric Touch": "V, S",
  "Water Breathing": "V, S, M (a short reed)",
  "Water Walk": "V, S, M (a piece of cork)",

  // Level 4
  "Arcane Eye": "V, S, M (a bit of bat fur)",
  "Aura of Life": "V",
  "Aura of Purity": "V",
  "Banishment": "V, S, M (a distasteful item)",
  "Blight": "V, S",
  "Compulsion": "V, S",
  "Confusion": "V, S, M (three nutshells)",
  "Conjure Minor Elementals": "V, S",
  "Control Water": "V, S, M (a drop of water and a pinch of dust)",
  "Death Ward": "V, S",
  "Dimension Door": "V",
  "Divination": "V, S, M (incense worth 25+ GP, which the spell consumes)",
  "Dominate Beast": "V, S",
  "Fabricate": "V, S",
  "Fire Shield": "V, S, M (a bit of phosphorus or a firefly)",
  "Freedom of Movement": "V, S, M (a leather strap)",
  "Giant Insect": "V, S",
  "Greater Invisibility": "V, S",
  "Guardian of Faith": "V",
  "Hallucinatory Terrain": "V, S, M (a mushroom)",
  "Ice Storm": "V, S, M (a pinch of dust and a few drops of water)",
  "Locate Creature": "V, S, M (fur from a bloodhound)",
  "Otiluke's Resilient Sphere": "V, S, M (a glass sphere)",
  "Phantasmal Killer": "V, S",
  "Polymorph": "V, S, M (a caterpillar cocoon)",
  "Staggering Smite": "V",
  "Stoneskin": "V, S, M (diamond dust worth 100+ GP, which the spell consumes)",
  "Wall of Fire": "V, S, M (a piece of phosphorus)",

  // Level 5
  "Animate Objects": "V, S",
  "Banishing Smite": "V",
  "Circle of Power": "V",
  "Cloudkill": "V, S",
  "Commune": "V, S, M (incense)",
  "Commune with Nature": "V, S",
  "Cone of Cold": "V, S, M (a small crystal or glass cone)",
  "Conjure Elemental": "V, S",
  "Contact Other Plane": "V",
  "Contagion": "V, S",
  "Destructive Wave": "V",
  "Dispel Evil and Good": "V, S, M (a prayer scroll)",
  "Dominate Person": "V, S",
  "Dream": "V, S, M (a handful of sand)",
  "Flame Strike": "V, S, M (a pinch of sulfur)",
  "Geas": "V",
  "Greater Restoration": "V, S, M (diamond dust worth 100+ GP, which the spell consumes)",
  "Hold Monster": "V, S, M (a straight piece of iron)",
  "Insect Plague": "V, S, M (a few grains of sugar and some kernels of grain)",
  "Legend Lore": "V, S, M (incense worth 250+ GP, which the spell consumes, and four ivory strips worth 50+ GP each)",
  "Mass Cure Wounds": "V, S",
  "Modify Memory": "V, S",
  "Passwall": "V, S, M (a pinch of sesame seeds)",
  "Planar Binding": "V, S, M (a jewel worth 1,000+ GP, which the spell consumes)",
  "Raise Dead": "V, S, M (a diamond worth 500+ GP, which the spell consumes)",
  "Scrying": "V, S, M (a focus worth 1,000+ GP, such as a crystal ball, a silver mirror, or a font filled with holy water)",
  "Seeming": "V, S",
  "Telekinesis": "V, S",
  "Teleportation Circle": "V, M (rare chalks and inks infused with precious gems worth 50+ GP, which the spell consumes)",
  "Tree Stride": "V, S",
  "Wall of Force": "V, S, M (a pinch of diamond dust)",
  "Wall of Stone": "V, S, M (a small block of granite)",

  // Level 6
  "Blade Barrier": "V, S",
  "Chain Lightning": "V, S, M (a bit of fur, a piece of amber, and three silver pins)",
  "Circle of Death": "V, S, M (the powder of a crushed black pearl worth 500+ GP)",
  "Conjure Fey": "V, S",
  "Create Undead": "V, S, M (one 150+ GP black onyx stone for each corpse)",
  "Disintegrate": "V, S, M (a lodestone and a pinch of dust)",
  "Eyebite": "V, S",
  "Find the Path": "V, S, M (a set of divinatory tools, such as bones, ivory sticks, cards, teeth, or carved runes, worth 100+ GP)",
  "Globe of Invulnerability": "V, S, M (a glass bead)",
  "Harm": "V, S",
  "Heal": "V, S",
  "Heroes' Feast": "V, S, M (a gem-encrusted bowl worth 1,000+ GP, which the spell consumes)",
  "Mass Suggestion": "V, M (a snake's tongue)",
  "Move Earth": "V, S, M (a clay and iron blade and a miniature model of a spade)",
  "Otto's Irresistible Dance": "V",
  "Planar Ally": "V, S",
  "Sunbeam": "V, S, M (a magnifying glass)",
  "True Seeing": "V, S, M (mushroom powder, saffron, and fat, plus an ointment for the eyes that costs 25+ GP, which the spell consumes)",
  "Wall of Ice": "V, S, M (a piece of quartz)",
  "Wall of Thorns": "V, S, M (a handful of thorns)",
  "Wind Walk": "V, S, M (fire and holy water)",
  "Word of Recall": "V",

  // Level 7
  "Conjure Celestial": "V, S",
  "Divine Word": "V",
  "Etherealness": "V, S",
  "Finger of Death": "V, S",
  "Fire Storm": "V, S",
  "Forcecage": "V, S, M (ruby dust worth 1,500+ GP)",
  "Mirage Arcane": "V, S",
  "Mordenkainen's Magnificent Mansion": "V, S, M (a miniature portal carved from ivory, a polished marble, and a tiny silver spoon, each worth 5+ GP)",
  "Plane Shift": "V, S, M (a forked, metal rod worth 250+ GP, attuned to a particular Plane of Existence)",
  "Prismatic Spray": "V, S",
  "Project Image": "V, S, M (a small replica of you worth 5+ GP)",
  "Regenerate": "V, S, M (a prayer wheel)",
  "Resurrection": "V, S, M (a diamond worth 1,000+ GP, which the spell consumes)",
  "Reverse Gravity": "V, S, M (a lodestone and iron filings)",
  "Sequester": "V, S, M (gem dust worth 5,000+ GP, which the spell consumes)",
  "Simulacrum": "V, S, M (snow or ice in quantities sufficient to make a life-size copy of the duplicated creature; some hair, fingernail clippings, or other piece of that creature's body placed inside the snow or ice; and powdered ruby worth 1,500+ GP, sprinkled over the duplicate and consumed by the spell)",
  "Symbol": "V, S, M (powdered diamond and opal worth 1,000+ GP, which the spell consumes)",
  "Teleport": "V",

  // Level 8
  "Animal Shapes": "V, S",
  "Antimagic Field": "V, S, M (iron filings)",
  "Antipathy/Sympathy": "V, S, M (a piece of alum soaked in vinegar for the Antipathy effect or a drop of honey for the Sympathy effect)",
  "Clone": "V, S, M (a diamond worth 1,000+ GP, which the spell consumes, and a sealable vessel worth 2,000+ GP that is large enough to hold the creature being cloned)",
  "Control Weather": "V, S, M (burning incense)",
  "Dominate Monster": "V, S",
  "Earthquake": "V, S, M (a fractured rock)",
  "Feeblemind": "V, S, M (a handful of clay, crystal, glass, or mineral spheres)",
  "Holy Aura": "V, S, M (a tiny reliquary worth 1,000+ GP)",
  "Incendiary Cloud": "V, S",
  "Maze": "V, S",
  "Mind Blank": "V, S",
  "Power Word Stun": "V",
  "Sunburst": "V, S, M (a piece of sunstone)",
  "Telepathy": "V, S, M (a pair of linked silver rings)",

  // Level 9
  "Astral Projection": "V, S, M (for each creature you affect with this spell, you must provide one jacinth worth 1,000+ GP and one silver bar worth 100+ GP, all of which the spell consumes)",
  "Foresight": "V, S, M (a hummingbird feather)",
  "Gate": "V, S, M (a diamond worth 5,000+ GP)",
  "Imprisonment": "V, S, M (a statuette of the target worth 500+ GP per Hit Die of the target)",
  "Mass Heal": "V, S",
  "Meteor Swarm": "V, S",
  "Power Word Heal": "V, S",
  "Power Word Kill": "V",
  "Prismatic Wall": "V, S",
  "Shapechange": "V, S, M (a jade circlet worth 1,500+ GP)",
  "Time Stop": "V",
  "True Polymorph": "V, S, M (a drop of mercury, a dollop of gum arabic, and a wisp of smoke)",
  "True Resurrection": "V, S, M (diamonds worth 25,000+ GP, which the spell consumes)",
  "Weird": "V, S",
  "Wish": "V",
};

// Track which spells got a default
const defaulted = [];
const matched = [];

// Process each spell - add components after ritual
const updatedSpells = spells.map(spell => {
  const components = componentsMap[spell.name];
  if (components) {
    matched.push(spell.name);
  } else {
    defaulted.push(spell.name);
  }

  // Build new object with components inserted after ritual
  const newSpell = {};
  for (const [key, value] of Object.entries(spell)) {
    newSpell[key] = value;
    if (key === 'ritual') {
      newSpell['components'] = components || "V, S";
    }
  }
  return newSpell;
});

// Write the updated file
fs.writeFileSync(spellsPath, JSON.stringify(updatedSpells, null, 2) + '\n', 'utf8');

console.log(`Total spells: ${spells.length}`);
console.log(`Matched from list: ${matched.length}`);
console.log(`Defaulted to "V, S": ${defaulted.length}`);
if (defaulted.length > 0) {
  console.log('Defaulted spells:', defaulted);
}
